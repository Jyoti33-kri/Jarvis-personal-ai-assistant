import re
import speech_recognition as sr
import os
import pyttsx3
import webbrowser
import datetime
import pyjokes
import random
import time





def say(text):
    engine = pyttsx3.init()
    voices = engine.getProperty('voices')
    engine.setProperty('voice', voices[1].id)
    engine.setProperty('rate', 175)
    engine.say(text)
    engine.runAndWait()





def take_command():
    r = sr.Recognizer()
    with sr.Microphone() as source:
        print(f"Recognizing...")
        r.pause_threshold =1
        audio = r.listen(source)

    try:
        query = r.recognize_google(audio, language='en-in')
        print(f"User said: {query}")
        say(query)
        return query
    except Exception as e:
        return "some Error Occurred.sorry from jarvis"


def journal_entry():
    say("Tell me about your day.")
    print("Listening for your journal entry...")

    r = sr.Recognizer()
    with sr.Microphone() as source:
        audio = r.listen(source)

    try:
        entry = r.recognize_google(audio, language='en-in')
        print(f"Your journal entry: {entry}")
        say("Got it. Saving your entry.")

        # Save to journal.txt with date and time
        with open("journal.txt", "a", encoding="utf-8") as f:
            now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            f.write(f"[{now}] {entry}\n")
            f.write("-" * 50 + "\n")

        say("Your journal entry has been saved successfully.")
    except Exception as e:
        print("Sorry, I couldn't record your journal entry.")
        say("Sorry, I couldn't record your journal entry.")


if __name__ == '__main__':
    print('pycharm')
    say("Hello, I am  your personal Assistant , How can I help you ")
    print("Hello, I am Your personal assistant,How can I help you ")


    while True:
        print("listening...")
        query = take_command()
        query = query.lower().replace("jarvis", "").strip()


        sites = [["youtube", "https://www.youtube.com"],
                 ["wikipedia", "https://www.wikipedia.com"],
                 ["google", "https://www.google.com"],
                 ["music", "https://music.youtube.com/"],
                 ["WhatsApp","https://web.whatsapp.com/"],
                 ["LinkedIn","https://in.linkedin.com/"],
                 ["weather", "https://www.msn.com/en-us/weather"]
                 ]
        for site in sites:
             if f"Open {site[0]}".lower() in query.lower():
                 say(f"opening {site[0]} ...")
                 webbrowser.open(site[1])


        if "play music" in query:
                musicPath = ("C:/Users/Dell/Downloads/flute-traditional-v1-251387.mp3")
                say("Opening music...")
                webbrowser.open(musicPath)


        elif "search google" in query or "search" in query:
            search_query = query.replace("Jarvis", "").replace("search google", "").strip()
            searchGoogle = ("https://www.google.com/search?q=" + (search_query))
            say("Searching...")
            print("Searching...")
            webbrowser.open(searchGoogle)

        elif "open chatgpt" in query or "chat" in query :
            chatgpt=("https://chatgpt.com/c/68712a38-906c-8010-a462-e934fba16adc")
            say("Opening chatgpt...")
            webbrowser.open(chatgpt)

        elif "time" in query.lower():
            strfTime = datetime.datetime.now(). strftime("%I:%M:%p")
            say(f" time is {strfTime}")
            print("The time is ",strfTime)

        elif "date" in query.lower():
            strfDate = datetime.datetime.now().strftime("Today is %d %B %Y")
            say(f" date is {strfDate}")
            print("The date is ", strfDate)

        elif "open camera".lower() in query.lower():
            os.system("start microsoft.windows.camera:")
            say(f"opening camera")
            print("opening camera")

        elif "microsoft store" in query.lower():
           os.system("start ms-windows-store:")
           say(f"opening Microsoft Store")
           print("opening Microsoft Store")

        elif "what is your name" in query:
            say("My name is suklu, and I am your personal AI assistant.")
            print("My name is suklu, and I am your personal AI assistant.")

        elif "how are you" in query or "how r u" in query:
            say("I am doing well, thank you for asking!")
            print("I am doing well, thank you for asking!")

        elif"give jokes" in query or "joke" in query:
           say(pyjokes.get_joke())
           print(pyjokes.get_joke())




        elif "journal" in query or "write diary" in query or "start journaling" in query:
            journal_entry()

        elif "show journal" in query or "read journal" in query:
            try:
                with open("journal.txt", "r", encoding="utf-8") as f:
                    entries = f.read()
                    print(entries)
                    say("Here are your past journal entries.")
            except FileNotFoundError:
                say("No journal entries found yet.")


        elif "heart rate" in query or "my pulse" in query or "check pulse" in query:
            bpm = random.randint(65, 95)  # simulate heart rate
            say(f"Your heart rate is approximately {bpm} beats per minute.")
            print(f"Your heart rate is approximately {bpm} BPM.")

            # Optional: small advice based on heart rate
            if bpm > 90:
                say("You seem a little active right now. Maybe take a deep breath.")
            elif bpm < 70:
                say("You seem quite relaxed. That's great!")


        elif "sleep computer" in query or "go to sleep" in query:
            say("Putting your system to sleep.")
            os.system("rundll32.exe powrprof.dll,SetSuspendState 0,1,0")

        elif "sleep for" in query:
            # Example command: "sleep for 5 seconds"
            try:
                words = query.split()
                seconds = int(words[words.index("for") + 1])
                say(f"Sleeping for {seconds} seconds.")
                time.sleep(seconds)
                say("I'm awake now.")
            except Exception:
                say("Sorry, I didn't catch how long to sleep.")

        elif "open computer" in query or "open my computer" in query or "open pc" in query:
            say("Opening This PC")
            os.system("explorer shell:MyComputerFolder")
            print("Opening This PC")






        elif "exit" in query or "stop" in query or "bye" in query:
           say("Good bye!" )
           print("Goodbye!")
           print("Goodbye!",quit())
